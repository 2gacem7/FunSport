version: '3.1'

services:
    www:
        container_name: nginx
        image: nginx:alpine
        build:
           context: .
           dockerfile: Dockerfile
        ports:
          - "80:80"
        depends_on:
          - back
          - front

    mongo:
        container_name: mongo
        image: mongo
        restart: always
        volumes:
            - ./bdd/:/data/db
        ports:
        - 27017:27017

    mongo-express:
        container_name: mongo-express
        image: mongo-express
        restart: always
        ports:
        - 8090:8081
        depends_on: 
          - mongo

    back:
        container_name: back
        build:
          args:
            user: daegon
            uid: 1000
          context: ./back
          dockerfile: Dockerfile
        restart: always
        volumes:
        - './back/:/usr/src/app'  
        ports:
        - 3000:3000
        depends_on: 
          - mongo

    front:
        container_name: front
        build:
            args:
                user: daegon
                uid: 1000
            context: ./front
            dockerfile: Dockerfile
        restart: always
        volumes:
        - './front/:/usr/src/app'
        depends_on: 
            - back
